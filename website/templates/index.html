{% extends 'base.html' %}

{% block content %}

<!--- Main -->
<main>
    <!-- Carousel -->
    <div class="carousel-container">
        <div class="row">
            <div class="col-12 col-md-2 col-lg-3"></div>

            <div class="col-12 col-md-3 col-lg-3 mx-md-auto text-center mt-4">
                <h2 class="max-width-500 mb-5"><br><br>Book an experience and live like a local on your next getaway</h2>
            </div>

            <!--------------------------------------- ** NOTE FOR MARKER ** --------------------------------------->
            <!--- Please note that not all styling for lottie image can be moved to style sheet hence why some styling is below  -->
            <!--- Also Lottie image is not imported locally as this couldn't be done without paying for premium image  -->

            <!-- Lottie animation container - large -->
            <div class="col-12 col-md-3 col-lg-3">
                <div class="lottie-container">
                    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
                    <div style="width: 450px; height: 350px; overflow: hidden;">
                        <lottie-player src="https://lottie.host/a5653a4f-9375-4c6a-8598-e9f612d4a866/8ZEHwQnFD4.json"
                            background="#849BFF" speed="1" style="width: 450px; height: 450px; margin-top: -50px;" loop autoplay
                            direction="1" mode="normal"></lottie-player>
                    </div>
                </div>
            </div>

            <div class="col-md-3"></div>

            <!-- Lottie animation container - mid-medium -->
            <div class="col-md-12 col-md-3 col-lg-3">
                <div class="lottie-container-mid-medium" style="width: 650px; height: 350px; overflow: hidden; text-align: center;">
                    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
                    <div style="width: 100%; height: 100%; display: inline-block; vertical-align: middle;">
                        <lottie-player src="https://lottie.host/a5653a4f-9375-4c6a-8598-e9f612d4a866/8ZEHwQnFD4.json"
                            background="#849BFF" speed="1" style="width: 100%; max-height: 100%;" loop autoplay direction="1"
                            mode="normal"></lottie-player>
                    </div>
                </div>
            </div>

            <!-- Lottie animation container - medium -->
            <div class="col-md-12 col-md-3 col-lg-3">
                <div class="lottie-container-medium" style="width: 550px; height: 350px; overflow: hidden; text-align: center;">
                    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
                    <div style="width: 100%; height: 100%; display: inline-block; vertical-align: middle;">
                        <lottie-player src="https://lottie.host/a5653a4f-9375-4c6a-8598-e9f612d4a866/8ZEHwQnFD4.json"
                            background="#849BFF" speed="1" style="width: 100%; max-height: 100%;" loop autoplay direction="1"
                            mode="normal"></lottie-player>
                    </div>
                </div>
            </div>


            <!-- Lottie animation container - small -->
            <div class="col-md-12 col-md-3 col-lg-3">
                <div class="lottie-container-small" style="width: 350px; height: 350px; overflow: hidden; text-align: center;">
                    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
                    <div style="width: 100%; height: 100%; display: inline-block; vertical-align: middle;">
                        <lottie-player src="https://lottie.host/a5653a4f-9375-4c6a-8598-e9f612d4a866/8ZEHwQnFD4.json"
                            background="#849BFF" speed="1" style="width: 100%; max-height: 100%;" loop autoplay direction="1"
                            mode="normal"></lottie-player>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-3 col-lg-3"></div>
        </div>
    </div>

    <!--- Main body - buttons + cards -->
    <div class="container wrapper">
        <br>
        <div class="container-fluid">

            <div class="row">
                <h3 class="custom-heading pb-2 pt-1">Book an experience</h3>
            </div>
            
            <!--- Search and radio button row -->
            <div class="row">
                <div class="col-md-8 mb-3 d-flex flex-column">

                    <!-- Event availabilty checkbox buttons  -->
                    <div class="d-flex">
                        <div>
                            <label class="pe-2">Events:</label>
                            <div id="checkbox_filter" class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="eventUpcoming" name="eventFilter" value="Upcoming" checked>
                                <label class="form-check-label" for="eventUpcoming"  style="padding-bottom: 15px">Upcoming</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="eventCurrent" name="eventFilter" value="Current" checked>
                                <label class="form-check-label" for="eventCurrent">Current</label>
                            </div>
                        </div>
                    </div>


                    <!-- Event category radio buttons -->
                    <div class="col-md-12 d-flex mb-3">
                        <div class="btn-group d-flex flex-wrap">
                            <button class="btn custom-btn toggle-button me-2 mb-2 rounded active" data-type="all">
                                All
                            </button>
                            <button class="btn custom-btn toggle-button me-2 mb-2 rounded" data-type="art-culture">
                                Art & Culture
                            </button>
                            <button class="btn custom-btn toggle-button me-2 mb-2 rounded" data-type="tours">
                                Tours
                            </button>
                            <button class="btn custom-btn toggle-button me-2 mb-2 rounded" data-type="food-drink">
                                Food & Drink
                            </button>
                            <button class="btn custom-btn toggle-button me-2 mb-2 rounded" data-type="unique">
                                Unique
                            </button>
                        </div>
                    </div>
                </div>
                <hr>
            </div>        
        </div>

        <!-- Cards -->
        <div id="all_cards">
            <div class="row" id="current">
                
                <!--- No results filter message-->
                <div id="noResultsMessage">
                    <br>
                    <div class="centered-message">
                        <br>
                        <h5>No results found. Please try another filter.</h5>
                    </div>
                </div>

                <!--- No results filter message-->
                <div id="adjustSearchMessage">
                    <br>
                    <div class="centered-message">
                        <br>
                        <h5>Please select at least one event type to see results.</h5>
                    </div>
                </div>

                <!-- Cards -->
                {% for experience in experiences %}
                <div class="custom-card mx-auto mx-3 left-align-card" data-type="{{ experience.type }}" data-status="{{ experience.status }}" data-name="{{ experience.name }}">
                    <div class="card box-shadow mx-auto homepage-card">
                        <a href="{{ url_for('experience.show', id=experience.id) }}">
                            <img src="{{ experience.image_1 }}" class="card-img-top">
                        </a>
                        
                        <!-- Status box in the top right corner -->
                        <div
                            class="{% if experience.status == 'Inactive' %}status-grey{% elif experience.status == 'Open' %}status-green{% elif experience.status == 'Sold Out' %}status-red{% elif experience.status == 'Cancelled' %}status-black{% endif %}">
                            {{ experience.status }}
                        </div>

                        </a>
                        <div class="card-body">
                            <h6 class="card-title">
                                <b>
                                <span class="homepage-card-name">{{experience.name}}</span>
                                <div class="homepage-card-spacer"></div>
                                </b>
                            </h6>
                            <hr>
                            <span class="homepage-card-name">Hosted by {{ experience.user.name }}</span>
                            <span class="homepage-card-duration float">${{experience.price}}pp</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

        <!-- JS to handle button click events and toggle "pressed" state -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const buttons = document.querySelectorAll(".toggle-button");
                const upcomingBtn = document.getElementById('eventUpcoming');
                const currentBtn = document.getElementById('eventCurrent');

                buttons.forEach(function (button) {
                    button.addEventListener("click", function () {
                        buttons.forEach(function (otherButton) {
                            otherButton.classList.remove("active");
                        });
                        this.classList.add("active");
                        filter(); // Call the filter function
                    });

                    // Add click event listeners to the upcoming and current checkboxes
                    upcomingBtn.addEventListener('change', function () {
                        filter();
                    });

                    currentBtn.addEventListener('change', function () {
                        filter();
                    });
                });
            });
        </script>


        <script>
            var upcomingEnabled = true;
            var currentEnabled = true;

            let global_status = "all";

            var upcomingbtn = document.getElementById('eventUpcoming');
            var currentBtn = document.getElementById('eventCurrent');
            var currentText = document.getElementById('currentText');
            var upcomingText = document.getElementById('hereeee');
            var searchBar = document.getElementById('search-input');

            currentBtn.addEventListener('click', function () {

                if (currentEnabled) {
                    $('#current .custom-card').each(function() {
                        
                        $(this).hide();
                        $(this).addClass("hidingCurrent");
                        
                    currentText.style.display = 'none';
                    });
                } else {
                    $('#current .custom-card').each(function() {
                        
                        if ($(this).hasClass('hidingCurrent')) {
                            $(this).show();
                            $(this).removeClass("hidingCurrent");
                        }
                        
                        currentText.style.display = 'block';
                    });
                }

                currentEnabled = !currentEnabled;

                filter();
            });

            upcomingbtn.addEventListener('click', function () {
                if (upcomingEnabled) {
                    $('#upcoming .custom-card').each(function() {
                        
                        $(this).hide();
                        $(this).addClass("hidingUpcoming");
                        upcomingText.style.display = 'none';
                    });
                } else {
                    $('#upcoming .custom-card').each(function() {
                        if ($(this).hasClass('hidingUpcoming')) {
                            $(this).show();
                            $(this).removeClass("hidingUpcoming");
                        }

                        upcomingText.style.display = 'block';

                    });
                }

                upcomingEnabled = !upcomingEnabled;

                filter();
                
            });

            const adjustSearchMessage = document.getElementById("adjustSearchMessage");
            adjustSearchMessage.style.display = "none";

            // Function to filter cards based on the selected filters
                function filter() {
                    const toggleButtons = document.querySelectorAll(".toggle-button");
                    const currentCards = document.querySelectorAll(".custom-card.mx-auto.mx-3.left-align-card");
                    const upcomingCards = document.querySelectorAll(".custom-card.mx-auto.mx-3.left-align-card.upcoming");
                    let activeButtonType;

                    toggleButtons.forEach(function (button) {
                        if (button.classList.contains('active')) {
                            activeButtonType = button.getAttribute("data-type");
                        }
                    });

                    const noResultsMessage = document.getElementById("noResultsMessage");
                    let anyCardsMatch = false;

                    if (upcomingEnabled && currentEnabled) {
                        // Both checkboxes are checked
                        currentCards.forEach(function (card) {
                            const cardType = card.getAttribute("data-type");
                            const cardStatus = card.getAttribute("data-status");

                            if (activeButtonType === "all" && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (activeButtonType === "all" && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else {
                                card.style.display = "none";
                            }
                        });
                        upcomingCards.forEach(function (card) {
                            const cardType = card.getAttribute("data-type");
                            const cardStatus = card.getAttribute("data-status");

                            if (activeButtonType === "all" && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (activeButtonType === "all" && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else {
                                card.style.display = "none";
                            }
                        });
                    } else if (upcomingEnabled) {
                        // Only upcoming checkbox is checked
                        currentCards.forEach(function (card) {
                            card.style.display = "none";
                        });
                        upcomingCards.forEach(function (card) {
                            const cardType = card.getAttribute("data-type");
                            const cardStatus = card.getAttribute("data-status");

                            if (activeButtonType === "all" && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (activeButtonType === "all" && cardStatus === global_status) {
                                card.style display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else {
                                card.style.display = "none";
                            }
                        });
                    } else if (currentEnabled) {
                        // Only current checkbox is checked
                        upcomingCards.forEach(function (card) {
                            card.style.display = "none";
                        });
                        currentCards.forEach(function (card) {
                            const cardType = card.getAttribute("data-type");
                            const cardStatus = card.getAttribute("data-status");

                            if (activeButtonType === "all" && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (activeButtonType === "all" && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && global_status === "all") {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else if (cardType === activeButtonType && cardStatus === global_status) {
                                card.style.display = "block";
                                anyCardsMatch = true;
                            } else {
                                card.style.display = "none";
                            }
                        });
                    }

                    if (anyCardsMatch) {
                        noResultsMessage.style.display = "none";
                    } else {
                        noResultsMessage.style.display = "block";
                    }

                    search();
                }


            document.addEventListener("DOMContentLoaded", function () {
                const typeButtons = document.querySelectorAll(".toggle-button");
                const statusDropdown = new bootstrap.Dropdown(document.getElementById("filterDropdown"));
                

                
                let anyCardsMatch = false;

                typeButtons.forEach(function (button) {
                    button.addEventListener("click", filter);
                });

                // Add click event listener to the status dropdown items
                const statusItems = document.querySelectorAll(".dropdown-item[data-status]");
                statusItems.forEach(function (item) {
                    item.addEventListener("click", function (event) {
                        event.preventDefault();
                        status = item.getAttribute("data-status");
                        global_status = status
                        filter();
                    });
                });


                // Initial filter when the page loads
                filter();
            });

            
            // Function to filter cards based on the search input
            $('#search-input').on('input', search);

            function search() {
                var searchText = searchBar.value.toLowerCase();
                $('#all_cards .custom-card').each(function() {
                    if ($(this).hasClass('hiding') || $(this).hasClass('hidingUpcoming') || $(this).hasClass('hidingCurrent')) {
                        //skips
                    } else {
                        var cardName = $(this).data('name').toLowerCase();
                        if (cardName.includes(searchText)) {
                            $(this).show();
                        } else {
                            $(this).hide();
                            
                        }
                    }
                });
            }
            
        </script>

</main>

{% endblock %}